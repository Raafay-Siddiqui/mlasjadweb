{% extends "base.html" %}

{% block body_class %}bg-dome{% endblock %}

{% block content %}
<style>
.cookies-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1200;
}
.cookies-modal[hidden] {
  display: none;
}
.cookies-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(8, 12, 24, 0.78);
  backdrop-filter: blur(6px);
}
.cookies-card {
  position: relative;
  background: rgba(17, 22, 40, 0.96);
  border: 1px solid rgba(94, 124, 250, 0.4);
  border-radius: 18px;
  padding: 28px;
  max-width: 520px;
  width: calc(100% - 32px);
  box-shadow: 0 24px 60px rgba(0,0,0,0.45);
  display: flex;
  flex-direction: column;
  gap: 14px;
  text-align: left;
}
.cookies-card h3 {
  margin: 0;
  font-size: 1.35rem;
}
.cookies-card p {
  margin: 0;
  color: #cbd3ff;
  line-height: 1.5;
}
.cookies-card .btn {
  align-self: flex-end;
}
#registration-form.is-disabled {
  opacity: 0.45;
  pointer-events: none;
}
#registration-form.is-disabled button[type="submit"] {
  cursor: not-allowed;
}

/* Password strength indicator styles */
#strengthText {
  font-weight: 600;
}

.strength-weak #strengthFill {
  background: #ff8b8b;
  width: 33%;
}

.strength-medium #strengthFill {
  background: #ffc107;
  width: 66%;
}

.strength-strong #strengthFill {
  background: #48e1a0;
  width: 100%;
}
</style>

<div class="card">
<div id="cookies-modal" class="cookies-modal" hidden>
  <div class="cookies-backdrop"></div>
  <div class="cookies-card">
    <h3>Cookie & Tracking Notice</h3>
    <p>Salaam! This website uses cookies to run essential features — including login, account preferences, and ensuring services work properly.</p>
    <p>We also use cookies for user tracking to improve courses and analytics. These cookies are required and cannot be opted out of.</p>
    <p>We do not share your data with third parties or other companies.</p>
    <button type="button" id="cookies-accept" class="btn primary">I Understand</button>
  </div>
</div>

  <div class="logo-big"></div>
  <h2>Register</h2>

  <form id="registration-form" action="/register" method="post" class="cookies-disabled">
    <input type="text" name="username" placeholder="Choose Username" required>
    <input
      type="password"
      name="password"
      id="password"
      placeholder="Choose Password (min. 6 characters)"
      required
      minlength="6"
      autocomplete="new-password"
    >

    <!-- Password strength indicator -->
    <div id="passwordStrength" style="margin-top: 10px; font-size: 0.85rem; display: none;">
      <div id="strengthBar" style="height: 4px; border-radius: 2px; background: #e0e0e0; margin-bottom: 5px;">
        <div id="strengthFill" style="height: 100%; border-radius: 2px; width: 0%; transition: all 0.3s;"></div>
      </div>
      <span id="strengthText"></span>
    </div>

    <input type="text" name="full_name" placeholder="Full Name" required>
    <input type="text" name="age" placeholder="Age" required>
    <input type="text" name="phone_number" placeholder="Phone Number" required>
    <input type="email" name="email" placeholder="Email Address" required>

    <!-- Terms of Service Agreement -->
    <div style="margin: 16px 0; text-align: left;">
      <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; color: var(--text);">
        <input
          type="checkbox"
          name="accept_terms"
          id="acceptTerms"
          required
          style="width: auto; margin: 4px 0 0 0; cursor: pointer; flex-shrink: 0;"
        >
        <span style="font-size: 0.95rem; line-height: 1.5;">
          I agree to the <a href="{{ url_for('terms') }}" target="_blank" style="color: var(--brand); text-decoration: underline;">Terms of Service</a>
        </span>
      </label>
    </div>

    <button type="submit" id="submitBtn">Register</button>
  </form>
</div>
<script>
(function() {
  // Cookie consent modal
  const modal = document.getElementById('cookies-modal');
  const acceptBtn = document.getElementById('cookies-accept');
  const form = document.getElementById('registration-form');

  if (!modal || !acceptBtn || !form) { return; }

  const acknowledged = document.cookie.split('; ').find(row => row.startsWith('cookies_acknowledged='));
  if (!acknowledged) {
    modal.hidden = false;
    form.classList.add('is-disabled');
    for (const input of form.querySelectorAll('input, button[type="submit"]')) {
      input.disabled = true;
    }
  }

  acceptBtn.addEventListener('click', () => {
    const expiry = new Date();
    expiry.setFullYear(expiry.getFullYear() + 1);
    document.cookie = `cookies_acknowledged=true; path=/; expires=${expiry.toUTCString()}`;
    modal.hidden = true;
    form.classList.remove('is-disabled');
    for (const input of form.querySelectorAll('input, button[type="submit"]')) {
      input.disabled = false;
    }
  });

  // Password strength checker
  const passwordInput = document.getElementById('password');
  const strengthIndicator = document.getElementById('passwordStrength');
  const strengthText = document.getElementById('strengthText');
  const strengthBar = document.getElementById('strengthBar');

  if (!passwordInput || !strengthIndicator) { return; }

  function checkPasswordStrength(password) {
    let strength = 0;

    if (password.length >= 6) strength++;
    if (password.length >= 10) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/\d/.test(password)) strength++;
    if (/[^a-zA-Z\d]/.test(password)) strength++;

    return strength;
  }

  passwordInput.addEventListener('input', function() {
    const password = this.value;

    if (password.length > 0) {
      strengthIndicator.style.display = 'block';
      const strength = checkPasswordStrength(password);

      // Remove all strength classes
      strengthBar.classList.remove('strength-weak', 'strength-medium', 'strength-strong');

      if (strength <= 2) {
        strengthBar.classList.add('strength-weak');
        strengthText.textContent = '⚠️ Weak password';
        strengthText.style.color = '#ff8b8b';
      } else if (strength <= 3) {
        strengthBar.classList.add('strength-medium');
        strengthText.textContent = '⚡ Medium password';
        strengthText.style.color = '#ffc107';
      } else {
        strengthBar.classList.add('strength-strong');
        strengthText.textContent = '✓ Strong password';
        strengthText.style.color = '#48e1a0';
      }
    } else {
      strengthIndicator.style.display = 'none';
    }
  });

  // Form validation before submit
  form.addEventListener('submit', function(e) {
    const password = passwordInput.value;
    const submitBtn = document.getElementById('submitBtn');

    if (password.length < 6) {
      e.preventDefault();
      alert('Password must be at least 6 characters long.');
      passwordInput.focus();
      return false;
    }

    // Show loading state
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
    }
  });
})();
</script>
{% endblock %}
