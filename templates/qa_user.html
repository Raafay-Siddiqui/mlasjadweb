{% extends "base.html" %}
{% block title %}My Questions{% endblock %}

{% block body_class %}bg-geometry{% endblock %}

{% block content %}
<div class="container" style="max-width:800px; margin-top:40px">
  <h2>ðŸ™‹ Your Questions</h2>
  <style>
    .sender.is-admin { color: #7c9cff; }
    .sender.is-user { color: #98ffd1; }
    .btn-sm {
      padding:4px 8px;
      font-size:0.8rem;
      margin-left:6px;
    }
  </style>

  <!-- Ask a new question -->
  <form action="{{ url_for('new_question') }}" method="POST" style="margin:20px 0; display:flex; flex-direction:column; gap:10px">
    <input type="text" name="title" placeholder="Enter your question title" required
           style="padding:12px; border-radius:10px; border:1px solid #444; background:#121935; color:white; font-size:1rem">

    <label style="font-size:0.9rem; color:#aaa">
      <input type="checkbox" name="is_public"> Public
    </label>

    <button type="submit" class="btn primary" 
            style="padding:12px 20px; font-size:1rem; border-radius:10px; width:200px">
      âž• Ask Question
    </button>
  </form>

  {% for q in questions %}
    <div style="background:#1a223f; padding:16px; border-radius:12px; margin-bottom:20px">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
        <span>
          <strong>{{ q.title }}</strong>
          {% if q.is_public %}
            <span style="color:lime">(Public)</span>
          {% else %}
            <span style="color:orange">(Private)</span>
          {% endif %}
        </span>

        <span>
          <!-- Toggle visibility -->
          <form action="{{ url_for('user_toggle_question', question_id=q.id) }}" method="POST" style="display:inline">
            <button type="submit" class="btn btn-sm">
              {% if q.is_public %}Make Private{% else %}Make Public{% endif %}
            </button>
          </form>

          <!-- Delete whole question -->
          <form action="{{ url_for('user_delete_question', question_id=q.id) }}" method="POST" style="display:inline"
                onsubmit="return confirm('Delete this question and all its messages?');">
            <button type="submit" class="btn danger btn-sm">ðŸ—‘ Delete</button>
          </form>
        </span>
      </div>

      <!-- Messages -->
      <div style="max-height:200px; overflow-y:auto; padding:10px; background:#0f1530; border-radius:8px; margin-bottom:12px">
        {% for msg in q.messages %}
          <p style="margin:6px 0">
            <strong class="sender {% if msg.sender == 'admin' %}is-admin{% else %}is-user{% endif %}">
              {{ msg.sender.capitalize() }}
            </strong>: {{ msg.body }}
            <small style="color:#888">
              {% if msg.created_at %}({{ msg.created_at.strftime('%Y-%m-%d %H:%M') }}){% endif %}
            </small>

            <!-- Delete own messages -->
            {% if msg.sender == 'user' %}
              <form action="{{ url_for('user_delete_message', message_id=msg.id) }}" method="POST" style="display:inline">
                <button type="submit" class="btn danger btn-sm">Delete</button>
              </form>
            {% endif %}
          </p>
        {% else %}
          <p style="color:#aaa; font-style:italic">No messages yet.</p>
        {% endfor %}
      </div>

      <!-- Send message -->
      <form action="{{ url_for('send_message', question_id=q.id) }}" method="POST" style="display:flex; flex-direction:column; gap:8px; margin-top:10px">
        <textarea name="body" placeholder="Type your messageâ€¦" required
                  style="width:100%; min-height:60px; padding:8px; border-radius:8px; border:1px solid #444; background:#121935; color:white; resize:vertical"></textarea>
        <button type="submit" class="btn primary" style="align-self:flex-end">Send</button>
      </form>
    </div>
  {% endfor %}
</div>
{% endblock %}
